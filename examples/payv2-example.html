<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A55Pay - Checkout Seguro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .checkout-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .checkout-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .checkout-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="20" cy="60" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .checkout-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .checkout-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .security-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
        }
        
        .checkout-content {
            padding: 40px;
        }
        
        .form-section {
            background: #f8faff;
            border: 1px solid #e1e8f0;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.1);
        }
        
        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
        }
        
        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2d3748;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
            font-size: 0.95rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .required-field::after {
            content: '*';
            color: #e53e3e;
            margin-left: 4px;
        }
        
        .shipping-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: #edf2f7;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .shipping-toggle:hover {
            background: #e2e8f0;
        }
        
        .shipping-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
        }
        
        .shipping-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            opacity: 0;
        }
        
        .shipping-section.active {
            max-height: 1000px;
            opacity: 1;
        }
        
        .pay-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            margin-top: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .pay-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .pay-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .pay-button .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pay-button.loading .loading-spinner {
            display: inline-block;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
        }
        
        .result.error {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
            border: none;
        }
        
        .result.loading {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
        }
        
        .charge-uuid-info {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #c53030;
        }
        
        .charge-uuid-info i {
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .checkout-container {
                margin: 10px;
                border-radius: 16px;
            }
            
            .checkout-content {
                padding: 20px;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .security-badges {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="checkout-container">
        <div class="checkout-header">
            <h1><i class="fas fa-shield-alt"></i> A55Pay Checkout</h1>
            <p>Pagamento seguro com autentica√ß√£o 3DS</p>
            <div class="security-badges">
                <div class="security-badge">
                    <i class="fas fa-lock"></i>
                    SSL Seguro
                </div>
                <div class="security-badge">
                    <i class="fas fa-credit-card"></i>
                    3DS 2.0
                </div>
                <div class="security-badge">
                    <i class="fas fa-fingerprint"></i>
                    Biometria
                </div>
            </div>
        </div>
        
        <div class="checkout-content">
            <div id="chargeUuidAlert" class="charge-uuid-info" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <strong>Charge UUID carregado da URL:</strong> <span id="urlChargeUuid"></span>
            </div>
            
            <form id="paymentForm">
                <!-- Informa√ß√µes da Transa√ß√£o -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3 class="section-title">Transa√ß√£o</h3>
                    </div>
                    <div class="form-group">
                        <label for="chargeUuid" class="required-field">Charge UUID</label>
                        <input type="text" id="chargeUuid" value="550e8400-e29b-41d4-a716-446655440000" required placeholder="UUID da transa√ß√£o">
                    </div>
                </div>

                <!-- Informa√ß√µes do Pagador -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3 class="section-title">Dados Pessoais</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payerName" class="required-field">Nome Completo</label>
                            <input type="text" id="payerName" value="Maria Silva Santos" required placeholder="Digite seu nome completo">
                        </div>
                        <div class="form-group">
                            <label for="payerEmail" class="required-field">E-mail</label>
                            <input type="email" id="payerEmail" value="maria@gmail.com" required placeholder="seu@email.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payerTaxId">CPF/CNPJ</label>
                            <input type="text" id="payerTaxId" value="123.456.789-01" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label for="cellPhone">Telefone</label>
                            <input type="text" id="cellPhone" value="(11) 98765-4321" placeholder="(11) 99999-9999">
                        </div>
                    </div>
                </div>

                <!-- Informa√ß√µes do Cart√£o -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <h3 class="section-title">Dados do Cart√£o</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="holderName" class="required-field">Nome no Cart√£o</label>
                            <input type="text" id="holderName" value="MARIA S SANTOS" required placeholder="Nome como impresso no cart√£o">
                        </div>
                        <div class="form-group">
                            <label for="cardNumber" class="required-field">N√∫mero do Cart√£o</label>
                            <input type="text" id="cardNumber" value="4111 1111 1111 1111" required placeholder="0000 0000 0000 0000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expiryMonth" class="required-field">M√™s</label>
                            <input type="text" id="expiryMonth" value="12" maxlength="2" required placeholder="MM">
                        </div>
                        <div class="form-group">
                            <label for="expiryYear" class="required-field">Ano</label>
                            <input type="text" id="expiryYear" value="2028" maxlength="4" required placeholder="AAAA">
                        </div>
                        <div class="form-group">
                            <label for="ccv" class="required-field">CVV</label>
                            <input type="text" id="ccv" value="123" maxlength="4" required placeholder="123">
                        </div>
                        <div class="form-group">
                            <label for="cardCryptogram">Card Cryptogram</label>
                            <input type="text" id="cardCryptogram" placeholder="Opcional">
                        </div>
                    </div>
                </div>

                <!-- Endere√ßo de Cobran√ßa -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3 class="section-title">Endere√ßo de Cobran√ßa</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="postalCode" class="required-field">CEP</label>
                            <input type="text" id="postalCode" value="01310-100" required placeholder="00000-000">
                        </div>
                        <div class="form-group">
                            <label for="street" class="required-field">Endere√ßo</label>
                            <input type="text" id="street" value="Av. Paulista" required placeholder="Nome da rua">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addressNumber" class="required-field">N√∫mero</label>
                            <input type="text" id="addressNumber" value="1578" required placeholder="123">
                        </div>
                        <div class="form-group">
                            <label for="complement">Complemento</label>
                            <input type="text" id="complement" value="Sala 1001" placeholder="Apto, sala, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="neighborhood" class="required-field">Bairro</label>
                            <input type="text" id="neighborhood" value="Bela Vista" required placeholder="Nome do bairro">
                        </div>
                        <div class="form-group">
                            <label for="city" class="required-field">Cidade</label>
                            <input type="text" id="city" value="S√£o Paulo" required placeholder="Nome da cidade">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="state" class="required-field">Estado</label>
                            <input type="text" id="state" value="SP" maxlength="2" required placeholder="SP">
                        </div>
                        <div class="form-group">
                            <label for="country" class="required-field">Pa√≠s</label>
                            <input type="text" id="country" value="BR" maxlength="2" required placeholder="BR">
                        </div>
                    </div>
                    
                    <!-- Toggle para Endere√ßo de Entrega -->
                    <div class="shipping-toggle" onclick="toggleShippingAddress()">
                        <input type="checkbox" id="differentShippingAddress">
                        <label for="differentShippingAddress" style="margin: 0; cursor: pointer; font-weight: 500;">
                            <i class="fas fa-truck"></i> Endere√ßo de entrega diferente
                        </label>
                    </div>
                </div>

                <!-- Endere√ßo de Entrega -->
                <div class="form-section shipping-section" id="shippingSection">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <h3 class="section-title">Endere√ßo de Entrega</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shippingPostalCode">CEP</label>
                            <input type="text" id="shippingPostalCode" value="04038-001" placeholder="00000-000">
                        </div>
                        <div class="form-group">
                            <label for="shippingStreet">Endere√ßo</label>
                            <input type="text" id="shippingStreet" value="Rua Fid√™ncio Ramos" placeholder="Nome da rua">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shippingAddressNumber">N√∫mero</label>
                            <input type="text" id="shippingAddressNumber" value="308" placeholder="123">
                        </div>
                        <div class="form-group">
                            <label for="shippingComplement">Complemento</label>
                            <input type="text" id="shippingComplement" value="Torre A - Apto 502" placeholder="Apto, sala, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shippingNeighborhood">Bairro</label>
                            <input type="text" id="shippingNeighborhood" value="Vila Ol√≠mpia" placeholder="Nome do bairro">
                        </div>
                        <div class="form-group">
                            <label for="shippingCity">Cidade</label>
                            <input type="text" id="shippingCity" value="S√£o Paulo" placeholder="Nome da cidade">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shippingState">Estado</label>
                            <input type="text" id="shippingState" value="SP" maxlength="2" placeholder="SP">
                        </div>
                        <div class="form-group">
                            <label for="shippingCountry">Pa√≠s</label>
                            <input type="text" id="shippingCountry" value="BR" maxlength="2" placeholder="BR">
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <button type="button" class="pay-button" id="authTestButton" style="background: linear-gradient(135deg, #38a169, #48bb78);">
                        <div class="loading-spinner"></div>
                        <i class="fas fa-shield-alt"></i> Testar Autentica√ß√£o
                    </button>
                    
                    <button type="submit" class="pay-button" id="payButton">
                        <div class="loading-spinner"></div>
                        <i class="fas fa-lock"></i> Finalizar Pagamento
                    </button>
                </div>
            </form>
            
            <div id="result"></div>
        </div>
    </div>

    <!-- A55Pay SDK -->
    <script src="../src/a55pay-sdk.js"></script>
    
    
    <script>
        // Fun√ß√£o para obter par√¢metros da URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                charge_uuid: params.get('charge_uuid'),
                amount: params.get('amount'),
                currency: params.get('currency')
            };
        }

        // Fun√ß√£o para toggle do endere√ßo de entrega
        function toggleShippingAddress() {
            const checkbox = document.getElementById('differentShippingAddress');
            const shippingSection = document.getElementById('shippingSection');
            
            if (checkbox.checked) {
                shippingSection.classList.add('active');
            } else {
                shippingSection.classList.remove('active');
            }
        }

        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = getUrlParams();
            
            // Se charge_uuid foi passado via URL, usar ele
            if (urlParams.charge_uuid) {
                document.getElementById('chargeUuid').value = urlParams.charge_uuid;
                document.getElementById('urlChargeUuid').textContent = urlParams.charge_uuid;
                document.getElementById('chargeUuidAlert').style.display = 'block';
            }
        });

        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const payButton = document.getElementById('payButton');
            const resultDiv = document.getElementById('result');
            
            // Desabilitar bot√£o e mostrar loading
            payButton.disabled = true;
            payButton.classList.add('loading');
            payButton.innerHTML = '<div class="loading-spinner"></div><i class="fas fa-lock"></i> Processando Pagamento...';
            resultDiv.innerHTML = '<div class="result loading"><i class="fas fa-spinner fa-spin"></i> Iniciando processo de pagamento seguro...</div>';
            
            // Coletar dados do formul√°rio
            const userData = {
                // Campos obrigat√≥rios do pagador
                payer_name: document.getElementById('payerName').value,
                payer_email: document.getElementById('payerEmail').value,
                holder_name: document.getElementById('holderName').value,
                number: document.getElementById('cardNumber').value,
                expiry_month: document.getElementById('expiryMonth').value,
                expiry_year: document.getElementById('expiryYear').value,
                ccv: document.getElementById('ccv').value,
                card_cryptogram: document.getElementById('cardCryptogram').value || undefined,
                postal_code: document.getElementById('postalCode').value,
                street: document.getElementById('street').value,
                address_number: document.getElementById('addressNumber').value,
                complement: document.getElementById('complement').value,
                neighborhood: document.getElementById('neighborhood').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                country: document.getElementById('country').value
            };

            // Adicionar campos opcionais do pagador se preenchidos
            const payerTaxId = document.getElementById('payerTaxId').value;
            const cellPhone = document.getElementById('cellPhone').value;
            
            if (payerTaxId) userData.payer_tax_id = payerTaxId;
            if (cellPhone) userData.cell_phone = cellPhone;

            // Verificar se endere√ßo de entrega √© diferente
            const differentShipping = document.getElementById('differentShippingAddress').checked;
            if (differentShipping) {
                userData.shipping_postal_code = document.getElementById('shippingPostalCode').value;
                userData.shipping_street = document.getElementById('shippingStreet').value;
                userData.shipping_address_number = document.getElementById('shippingAddressNumber').value;
                userData.shipping_complement = document.getElementById('shippingComplement').value;
                userData.shipping_neighborhood = document.getElementById('shippingNeighborhood').value;
                userData.shipping_city = document.getElementById('shippingCity').value;
                userData.shipping_state = document.getElementById('shippingState').value;
                userData.shipping_country = document.getElementById('shippingCountry').value;
            }

            const config = {
                charge_uuid: document.getElementById('chargeUuid').value,
                userData: userData,
                
                onReady: function() {
                    resultDiv.innerHTML = '<div class="result loading"><i class="fas fa-shield-alt fa-pulse"></i> Executando autentica√ß√£o 3DS, coleta de dados do dispositivo e verifica√ß√µes de seguran√ßa...</div>';
                },
                
                onSuccess: function(result) {
                    console.log('Payment success:', result);
                    payButton.disabled = false;
                    payButton.classList.remove('loading');
                    payButton.innerHTML = '<i class="fas fa-lock"></i> Finalizar Pagamento Seguro';
                    
                    let statusMessage = 'üéâ Pagamento processado com sucesso!';
                    let additionalInfo = '';
                    
                    if (result.threeds_completed) {
                        statusMessage = 'üéâ Pagamento aprovado ap√≥s autentica√ß√£o 3DS!';
                        additionalInfo = '\n\nüîê Autentica√ß√£o 3DS conclu√≠da com sucesso';
                    }
                    
                    if (result.pending) {
                        statusMessage = '‚è≥ Pagamento em processamento...';
                        additionalInfo = '\n\n‚ö†Ô∏è O pagamento est√° sendo processado e ser√° confirmado em breve.';
                    }
                    
                    resultDiv.innerHTML = `<div class="result success">${statusMessage}${additionalInfo}

                   üìä Detalhes da Transa√ß√£o:
                   <pre>${JSON.stringify(result, null, 2)}</pre></div>`;
                },
                
                onError: function(error) {
                    console.error('Payment error:', error);
                    payButton.disabled = false;
                    payButton.classList.remove('loading');
                    payButton.innerHTML = '<i class="fas fa-lock"></i> Finalizar Pagamento Seguro';
                    
                    let errorMessage = error.message || error;
                    let helpText = '';
                    
                    if (errorMessage.includes('3DS')) {
                        helpText = '\n\nüí° Dica: Problemas com autentica√ß√£o 3DS podem ocorrer devido a bloqueios do navegador ou dados incorretos.';
                    } else if (errorMessage.includes('declined') || errorMessage.includes('rejected')) {
                        helpText = '\n\nüí° Dica: Verifique os dados do cart√£o ou tente com outro cart√£o.';
                    }
                    
                    resultDiv.innerHTML = `<div class="result error">‚ùå Erro no pagamento

                    <pre>${errorMessage}${helpText}</pre></div>`;
                }
            };
            
            // Chamar PayV2
            try {
                A55Pay.payV2(config);
            } catch (error) {
                console.error('SDK error:', error);
                payButton.disabled = false;
                payButton.classList.remove('loading');
                payButton.innerHTML = '<i class="fas fa-lock"></i> Finalizar Pagamento Seguro';
                resultDiv.innerHTML = `<div class="result error">‚ùå Erro no SDK: ${error.message}</div>`;
            }
        });
        
        // Formata√ß√£o autom√°tica de campos
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            let formattedValue = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = formattedValue;
        });
        
        document.getElementById('cellPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            }
            e.target.value = value;
        });
        
        document.getElementById('payerTaxId').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            } else {
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            }
            e.target.value = value;
        });
        
        document.getElementById('postalCode').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
            }
            e.target.value = value;
        });
        
        document.getElementById('shippingPostalCode').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
            }
            e.target.value = value;
        });

        // Toggle do endere√ßo de entrega
        document.getElementById('differentShippingAddress').addEventListener('change', toggleShippingAddress);

        // Bot√£o de teste de autentica√ß√£o
        document.getElementById('authTestButton').addEventListener('click', function() {
            const authButton = document.getElementById('authTestButton');
            const resultDiv = document.getElementById('result');
            
            // Desabilitar bot√£o e mostrar loading
            authButton.disabled = true;
            authButton.classList.add('loading');
            authButton.innerHTML = '<div class="loading-spinner"></div><i class="fas fa-shield-alt"></i> Testando...';
            resultDiv.innerHTML = '<div class="result loading"><i class="fas fa-spinner fa-spin"></i> Testando apenas a autentica√ß√£o...</div>';
            
            // Dados para teste de autentica√ß√£o
            const authConfig = {
                transactionReference: document.getElementById('chargeUuid').value,
                cardBrand: getCardBrandFromNumber(document.getElementById('cardNumber').value),
                cardExpiryMonth: document.getElementById('expiryMonth').value,
                cardExpiryYear: document.getElementById('expiryYear').value,
                cardNumber: document.getElementById('cardNumber').value.replace(/\s/g, ''),
                
                onSuccess: function(result) {
                    console.log('Authentication test success:', result);
                    authButton.disabled = false;
                    authButton.classList.remove('loading');
                    authButton.innerHTML = '<i class="fas fa-shield-alt"></i> Testar Autentica√ß√£o';
                    
                    resultDiv.innerHTML = `<div class="result success">üéâ Teste de autentica√ß√£o conclu√≠do com sucesso!

üîê Session ID gerado: ${result.sessionId}
üîë Access Token: ${result.accessToken ? 'Presente' : 'Ausente'}
üìã Reference ID: ${result.referenceId}
‚è±Ô∏è Timeout: ${result.timeout ? 'Sim (mas provavelmente funcionou)' : 'N√£o'}

üìä Resultado completo:
<pre>${JSON.stringify(result, null, 2)}</pre>

‚úÖ Este session_id pode ser usado no pagamento!</div>`;
                },
                
                onError: function(error) {
                    console.error('Authentication test error:', error);
                    authButton.disabled = false;
                    authButton.classList.remove('loading');
                    authButton.innerHTML = '<i class="fas fa-shield-alt"></i> Testar Autentica√ß√£o';
                    
                    let helpText = '';
                    if (error.message.includes('setup-authentication')) {
                        helpText = '\n\nüí° Dica: Verifique se o backend est√° rodando na URL correta.';
                    } else if (error.message.includes('timeout')) {
                        helpText = '\n\nüí° Dica: Timeout pode ser normal. O importante √© que o processo foi iniciado.';
                    }
                    
                    resultDiv.innerHTML = `<div class="result error">‚ùå Erro no teste de autentica√ß√£o

${error.message || error}${helpText}

üîç Verifique o console do navegador para mais detalhes.</div>`;
                }
            };
            
            try {
                A55Pay.authentication(authConfig);
            } catch (error) {
                console.error('SDK authentication error:', error);
                authButton.disabled = false;
                authButton.classList.remove('loading');
                authButton.innerHTML = '<i class="fas fa-shield-alt"></i> Testar Autentica√ß√£o';
                resultDiv.innerHTML = `<div class="result error">‚ùå Erro no SDK: ${error.message}</div>`;
            }
        });

        // Fun√ß√£o auxiliar para detectar bandeira do cart√£o
        function getCardBrandFromNumber(cardNumber) {
            if (!cardNumber) return 'Visa';
            
            const number = cardNumber.replace(/\D/g, '');
            
            if (/^4/.test(number)) return 'Visa';
            if (/^5[1-5]/.test(number) || /^2[2-7]/.test(number)) return 'MasterCard';
            if (/^3[47]/.test(number)) return 'AmericanExpress';
            if (/^6(?:011|5)/.test(number)) return 'Discover';
            if (/^35/.test(number)) return 'JCB';
            if (/^3[0689]/.test(number)) return 'DinersClub';
            if (/^606282|^637095|^637568|^637599|^637609|^637612/.test(number)) return 'Hipercard';
            if (/^636368|^438935|^504175|^451416|^636297/.test(number)) return 'Elo';
            
            return 'Visa'; // Default
        }
    </script>
</body>
</html>
